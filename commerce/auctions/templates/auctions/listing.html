{% extends "auctions/layout.html" %}

{% block body %}
<h2>{{listing.title}}</h2>
<div class="listing-flexbox">
    <!--Caso estiver Aberta-->    
    {% if listing.active == True %}
    <div class="listing-image-watchlistbtn">
        <img width=300px class="listing-image" src="{{ listing.url_image }}">
        {% if not already_on_watchlist %}
        <!--Botão de add ou deletar da Watchlist-->   
        <form action="{% url 'watchlist' %}" method="POST">
            {% csrf_token %}
            <button class="btn btn-primary btn-lg" type="submit" name="listing_id" value="{{listing.id}}">Add to Wacthlist</button>
        </form>
        {% else %}
        <form action="{% url 'watchlist_delete' %}" method="POST">
            {% csrf_token %}    
            <button class="btn btn-warning btn-lg" type="submit" name="listing_id" value="{{listing.id}}">Delete from Wacthlist</button>    
        </form>
        {% endif %}
    </div>
    <div class="listing-content">
        {% if listing.owner == request.user %} 
        <form action="{% url 'close' %}" method="POST">
        {% csrf_token %}
        <button class="btn btn-danger btn-lg" type="submit" name="listing_id" value="{{listing.id}}">Close Listing</button>
        </form>
        {% endif %}
        <div class="description">
            Description: <BR>
            {{listing.description}}
        </div>

        <div class="bid-box">
            <div class="lastbid">Last Bid: ${{price}}</div>
            <form action="{% url 'bid' %}" method=POST class="bid-form">
                {% csrf_token %} 
                {{ PlaceBidForm }}
                <button class="btn btn-success bid-btn-box" type="submit" name="listing_id" value="{{listing.id}}">Place Bid</button>
            </form>
            {% if LastBidOwner and LastBidOwner.owner == request.user %}
            <div class="alert alert-warning alert-dismissible fade show" role="alert">Your bid is the last bid</div>
            {% endif %}
        </div>
    </div>

</div>

       



<!--Form de lances-->    



<!--Form Comentário-->
<div class="comment-box">
    <H3>Comments</H3>
    <div class="comment-box-content">
    
    {% for comment in comments %}
    <div class="comments">
    <div>{{comment.owner}}: {{comment.comment}}</div>
    </div>
    {% endfor %}
    {% if not request.user.is_anonymous %}
    <form action="{% url 'comment' %}" method=POST class="comment-form">
        {% csrf_token %} 
        {{ CommentForm }}
        <button class="btn btn-secondary bid-btn-box" type="submit" name="listing_id" value="{{listing.id}}">Comment</button>  
    </form>
    {% endif %}
    </div>  
</div>


    <!--Caso estiver Fechada-->
    {% else %}
<br>
Status: Closed
<br>
        {% if LastBidOwner and LastBidOwner.owner == request.user %}
You Are the Winner
Winner Bid: ${{price}}
        {% endif %}    
    {% endif %}
{% endblock %}